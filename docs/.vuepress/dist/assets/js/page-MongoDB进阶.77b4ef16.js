(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{510:function(t,s,a){"use strict";a.r(s);var n=a(1),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mongodb-进阶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-进阶"}},[t._v("#")]),t._v(" MongoDB 进阶")]),t._v(" "),a("h2",{attrs:{id:"mongodb-索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-索引"}},[t._v("#")]),t._v(" MongoDB 索引")]),t._v(" "),a("blockquote",[a("p",[t._v("索引是对数据库表中一列或多列的值进行排序的一种结构，使用索引可快速访问数据库表中的特定信息。")])]),t._v(" "),a("h3",{attrs:{id:"_1、获取现有索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、获取现有索引"}},[t._v("#")]),t._v(" 1、获取现有索引")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("db.student.getIndexes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("blockquote",[a("p",[t._v("Mongodb 默认索引 _id 字段")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/images/bestshi.com_2021-04-22_15-14-05.jpg")}}),t._v(" "),a("h3",{attrs:{id:"_2、创建索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、创建索引"}},[t._v("#")]),t._v(" 2、创建索引")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("db.student.ensureIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name:1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1：表示索引升序排序")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -1：表示索引降序排序")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("img",{attrs:{src:t.$withBase("/images/bestshi.com_2021-04-22_15-16-05.jpg")}}),t._v(" "),a("h3",{attrs:{id:"_3、复合索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、复合索引"}},[t._v("#")]),t._v(" 3、复合索引")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("db.student.ensureIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name:1,age:-1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1：表示索引升序排序")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -1：表示索引降序排序")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[a("strong",[t._v("复合索引查询表达式必须遵循指定的索引的顺序。")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/images/bestshi.com_2021-04-22_15-23-32.jpg")}}),t._v(" "),a("h3",{attrs:{id:"_4、数组索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、数组索引"}},[t._v("#")]),t._v(" 4、数组索引")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据格式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"address"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"city"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Los Angeles"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"state"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"California"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pincode"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"tags"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"music"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cricket"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blogs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Tom Benzamin"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("db.blogs.ensureIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("tags:1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("strong",[t._v("在数组中创建索引，需要对数组中的每个字段依次建立索引。")])]),t._v(" "),a("h3",{attrs:{id:"_5、唯一索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、唯一索引"}},[t._v("#")]),t._v(" 5、唯一索引")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("db.blogs.ensureIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name:1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("unique:true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"_6、删除索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、删除索引"}},[t._v("#")]),t._v(" 6、删除索引")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("db.blogs.dropIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("tags:1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"_7、ensureindex-中的其它参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、ensureindex-中的其它参数"}},[t._v("#")]),t._v(" 7、ensureIndex()中的其它参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("background")]),t._v(" "),a("td",[t._v("Boolean")]),t._v(" "),a("td",[t._v('建索引过程会阻塞其它数据库操作，background 可指定以后台方式创建索引，即增加 "background" 可选参数。 "background" 默认值为 false。')])]),t._v(" "),a("tr",[a("td",[t._v("unique")]),t._v(" "),a("td",[t._v("Boolean")]),t._v(" "),a("td",[t._v("建立的索引是否唯一。指定为 true 创建唯一索引。默认值为 false.")])]),t._v(" "),a("tr",[a("td",[t._v("name")]),t._v(" "),a("td",[t._v("string")]),t._v(" "),a("td",[t._v("索引的名称。如果未指定，MongoDB 的通过连接索引的字段名和排序顺序生成一个索引名称。")])]),t._v(" "),a("tr",[a("td",[t._v("dropDups")]),t._v(" "),a("td",[t._v("Boolean")]),t._v(" "),a("td",[t._v("在建立唯一索引时是否删除重复记录,指定 true 创建唯一索引。默认值为 false.")])]),t._v(" "),a("tr",[a("td",[t._v("sparse")]),t._v(" "),a("td",[t._v("Boolean")]),t._v(" "),a("td",[t._v("对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为 true 的话，在索引字段中不会查询出不包含对应字段的文档.。默认值为 false.")])]),t._v(" "),a("tr",[a("td",[t._v("expireAfterSeconds")]),t._v(" "),a("td",[t._v("integer")]),t._v(" "),a("td",[t._v("指定一个以秒为单位的数值，完成 TTL 设定，设定集合的生存时间。")])]),t._v(" "),a("tr",[a("td",[t._v("v")]),t._v(" "),a("td",[t._v("index version")]),t._v(" "),a("td",[t._v("索引的版本号。默认的索引版本取决于 mongod 创建索引时运行的版本。")])]),t._v(" "),a("tr",[a("td",[t._v("weights")]),t._v(" "),a("td",[t._v("document")]),t._v(" "),a("td",[t._v("索引权重值，数值在 1 到 99,999 之间，表示该索引相对于其他索引字段的得分权重。")])]),t._v(" "),a("tr",[a("td",[t._v("default_language")]),t._v(" "),a("td",[t._v("string")]),t._v(" "),a("td",[t._v("对于文本索引，该参数决定了停用词及词干和词器的规则的列表。 默认为英语")])]),t._v(" "),a("tr",[a("td",[t._v("language_override")]),t._v(" "),a("td",[t._v("string")]),t._v(" "),a("td",[t._v("对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的 language，默认值为 language.")])])])]),t._v(" "),a("h3",{attrs:{id:"_8、索引限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、索引限制"}},[t._v("#")]),t._v(" 8、索引限制")]),t._v(" "),a("h4",{attrs:{id:"额外开销"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#额外开销"}},[t._v("#")]),t._v(" "),a("strong",[t._v("额外开销")])]),t._v(" "),a("ul",[a("li",[t._v("每个索引占据一定的存储空间，在进行插入，更新和删除操作时也需要对索引进行操作。所以，如果你很少对集合进行读取操作，建议不使用索引。")])]),t._v(" "),a("h4",{attrs:{id:"内存-ram-使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内存-ram-使用"}},[t._v("#")]),t._v(" "),a("strong",[t._v("内存(RAM)使用")])]),t._v(" "),a("ul",[a("li",[t._v("由于索引是存储在内存(RAM)中,你应该确保该索引的大小不超过内存的限制。")]),t._v(" "),a("li",[t._v("如果索引的大小大于内存的限制，MongoDB 会删除一些索引，这将导致性能下降。")])]),t._v(" "),a("h4",{attrs:{id:"查询限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询限制"}},[t._v("#")]),t._v(" "),a("strong",[t._v("查询限制")])]),t._v(" "),a("ul",[a("li",[t._v("索引不能被以下的查询使用：\n"),a("ul",[a("li",[t._v("正则表达式及非操作符，如 $nin, $not, 等。")]),t._v(" "),a("li",[t._v("算术运算符，如 $mod, 等。")]),t._v(" "),a("li",[t._v("$where 子句")]),t._v(" "),a("li",[t._v("所以，检测你的语句是否使用索引是一个好的习惯，可以用 explain 来查看。")])])])]),t._v(" "),a("h4",{attrs:{id:"索引键限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引键限制"}},[t._v("#")]),t._v(" "),a("strong",[t._v("索引键限制")])]),t._v(" "),a("ul",[a("li",[t._v("从 2.6 版本开始，如果现有的索引字段的值超过索引键的限制，MongoDB 中不会创建索引。")])]),t._v(" "),a("h4",{attrs:{id:"插入文档超过索引键限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插入文档超过索引键限制"}},[t._v("#")]),t._v(" "),a("strong",[t._v("插入文档超过索引键限制")])]),t._v(" "),a("ul",[a("li",[t._v("如果文档的索引字段值超过了索引键的限制，MongoDB 不会将任何文档转换成索引的集合。与 mongorestore 和 mongoimport 工具类似。")])]),t._v(" "),a("h4",{attrs:{id:"最大范围"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最大范围"}},[t._v("#")]),t._v(" "),a("strong",[t._v("最大范围")])]),t._v(" "),a("ul",[a("li",[t._v("集合中索引不能超过 64 个")]),t._v(" "),a("li",[t._v("索引名的长度不能超过 125 个字符")]),t._v(" "),a("li",[t._v("一个复合索引最多可以有 31 个字段")])]),t._v(" "),a("h3",{attrs:{id:"_9、explain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9、explain"}},[t._v("#")]),t._v(" 9、explain()")]),t._v(" "),a("blockquote",[a("p",[t._v("explain 能获得查询方面诸多有用的信息。只要对游标调用该方法，就可以得到查询细节。explain 会返回一个文档，而不是游标本身。")])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取查询时间")]),t._v("\ndb.blogs.find"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("tags:"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'music44444'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".explain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'executionStats'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("img",{attrs:{src:t.$withBase("/images/bestshi.com_2021-04-22_19-01-51.jpg")}}),t._v(" "),a("h2",{attrs:{id:"mongodb-聚合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-聚合"}},[t._v("#")]),t._v(" MongoDB 聚合")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("使用到的数据")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("db.mycol.insert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        title: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MongoDB Overview"')]),t._v(",\n        description: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MongoDB is no sql database"')]),t._v(",\n        by_user: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"w3cschool.cc"')]),t._v(",\n        url: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.w3cschool.cc"')]),t._v(",\n        tags: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongodb"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"database"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NoSQL"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n        likes: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        title: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NoSQL Overview"')]),t._v(",\n        description: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"No sql database is very fast"')]),t._v(",\n        by_user: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"w3cschool.cc"')]),t._v(",\n        url: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.w3cschool.cc"')]),t._v(",\n        tags: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongodb"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"database"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NoSQL"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n        likes: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        title: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Neo4j Overview"')]),t._v(",\n        description: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Neo4j is no sql database"')]),t._v(",\n        by_user: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Neo4j"')]),t._v(",\n        url: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.neo4j.com"')]),t._v(",\n        tags: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"neo4j"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"database"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NoSQL"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n        likes: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("750")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br")])])]),t._v(" "),a("blockquote",[a("p",[t._v("MongoDB 中聚合(aggregate)主要用于处理数据(诸如统计平均值,求和等)，并返回计算后的数据结果。有点类似 sql 语句中的 count(*), sum(), avg()。")])]),t._v(" "),a("p",[a("strong",[t._v("聚合表达式")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("表达式")]),t._v(" "),a("th",[t._v("描述")]),t._v(" "),a("th",[t._v("实例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("$sum")]),t._v(" "),a("td",[t._v("计算总和。")]),t._v(" "),a("td",[t._v("db.mycol.aggregate([{"),a("span",{staticClass:"katex-error",attrs:{title:'ParseError: KaTeX parse error: Expected &#039;}&#039;, got &#039;EOF&#039; at end of input: …roup : {_id : "'}},[t._v('group : {_id : "')]),t._v('by_user", num_tutorial : {'),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[a("semantics",[a("mrow",[a("mi",[t._v("s")]),a("mi",[t._v("u")]),a("mi",[t._v("m")]),a("mo",[t._v(":")]),a("mi",{attrs:{mathvariant:"normal"}},[t._v('"')])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v('sum : "')])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.43056em","vertical-align":"0em"}}),a("span",{staticClass:"mord mathnormal"},[t._v("s")]),a("span",{staticClass:"mord mathnormal"},[t._v("u")]),a("span",{staticClass:"mord mathnormal"},[t._v("m")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}}),a("span",{staticClass:"mrel"},[t._v(":")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}})]),a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),a("span",{staticClass:"mord"},[t._v('"')])])])]),t._v('likes"}}}])')])]),t._v(" "),a("tr",[a("td",[t._v("$avg")]),t._v(" "),a("td",[t._v("计算平均值")]),t._v(" "),a("td",[t._v("db.mycol.aggregate([{"),a("span",{staticClass:"katex-error",attrs:{title:'ParseError: KaTeX parse error: Expected &#039;}&#039;, got &#039;EOF&#039; at end of input: …roup : {_id : "'}},[t._v('group : {_id : "')]),t._v('by_user", num_tutorial : {'),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[a("semantics",[a("mrow",[a("mi",[t._v("a")]),a("mi",[t._v("v")]),a("mi",[t._v("g")]),a("mo",[t._v(":")]),a("mi",{attrs:{mathvariant:"normal"}},[t._v('"')])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v('avg : "')])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.625em","vertical-align":"-0.19444em"}}),a("span",{staticClass:"mord mathnormal"},[t._v("a")]),a("span",{staticClass:"mord mathnormal",staticStyle:{"margin-right":"0.03588em"}},[t._v("vg")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}}),a("span",{staticClass:"mrel"},[t._v(":")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}})]),a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),a("span",{staticClass:"mord"},[t._v('"')])])])]),t._v('likes"}}}])')])]),t._v(" "),a("tr",[a("td",[t._v("$min")]),t._v(" "),a("td",[t._v("获取集合中所有文档对应值得最小值。")]),t._v(" "),a("td",[t._v("db.mycol.aggregate([{"),a("span",{staticClass:"katex-error",attrs:{title:'ParseError: KaTeX parse error: Expected &#039;}&#039;, got &#039;EOF&#039; at end of input: …roup : {_id : "'}},[t._v('group : {_id : "')]),t._v('by_user", num_tutorial : {'),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[a("semantics",[a("mrow",[a("mi",[t._v("m")]),a("mi",[t._v("i")]),a("mi",[t._v("n")]),a("mo",[t._v(":")]),a("mi",{attrs:{mathvariant:"normal"}},[t._v('"')])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v('min : "')])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.65952em","vertical-align":"0em"}}),a("span",{staticClass:"mord mathnormal"},[t._v("min")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}}),a("span",{staticClass:"mrel"},[t._v(":")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}})]),a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),a("span",{staticClass:"mord"},[t._v('"')])])])]),t._v('likes"}}}])')])]),t._v(" "),a("tr",[a("td",[t._v("$max")]),t._v(" "),a("td",[t._v("获取集合中所有文档对应值得最大值。")]),t._v(" "),a("td",[t._v("db.mycol.aggregate([{"),a("span",{staticClass:"katex-error",attrs:{title:'ParseError: KaTeX parse error: Expected &#039;}&#039;, got &#039;EOF&#039; at end of input: …roup : {_id : "'}},[t._v('group : {_id : "')]),t._v('by_user", num_tutorial : {'),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[a("semantics",[a("mrow",[a("mi",[t._v("m")]),a("mi",[t._v("a")]),a("mi",[t._v("x")]),a("mo",[t._v(":")]),a("mi",{attrs:{mathvariant:"normal"}},[t._v('"')])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v('max : "')])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.43056em","vertical-align":"0em"}}),a("span",{staticClass:"mord mathnormal"},[t._v("ma")]),a("span",{staticClass:"mord mathnormal"},[t._v("x")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}}),a("span",{staticClass:"mrel"},[t._v(":")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}})]),a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),a("span",{staticClass:"mord"},[t._v('"')])])])]),t._v('likes"}}}])')])]),t._v(" "),a("tr",[a("td",[t._v("$push")]),t._v(" "),a("td",[t._v("在结果文档中插入值到一个数组中。")]),t._v(" "),a("td",[t._v("db.mycol.aggregate([{"),a("span",{staticClass:"katex-error",attrs:{title:'ParseError: KaTeX parse error: Expected &#039;}&#039;, got &#039;EOF&#039; at end of input: …roup : {_id : "'}},[t._v('group : {_id : "')]),t._v('by_user", url : {'),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[a("semantics",[a("mrow",[a("mi",[t._v("p")]),a("mi",[t._v("u")]),a("mi",[t._v("s")]),a("mi",[t._v("h")]),a("mo",[t._v(":")]),a("mi",{attrs:{mathvariant:"normal"}},[t._v('"')])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v('push: "')])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.8888799999999999em","vertical-align":"-0.19444em"}}),a("span",{staticClass:"mord mathnormal"},[t._v("p")]),a("span",{staticClass:"mord mathnormal"},[t._v("u")]),a("span",{staticClass:"mord mathnormal"},[t._v("s")]),a("span",{staticClass:"mord mathnormal"},[t._v("h")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}}),a("span",{staticClass:"mrel"},[t._v(":")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}})]),a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),a("span",{staticClass:"mord"},[t._v('"')])])])]),t._v('url"}}}])')])]),t._v(" "),a("tr",[a("td",[t._v("$addToSet")]),t._v(" "),a("td",[t._v("在结果文档中插入值到一个数组中，但不创建副本。")]),t._v(" "),a("td",[t._v("db.mycol.aggregate([{"),a("span",{staticClass:"katex-error",attrs:{title:'ParseError: KaTeX parse error: Expected &#039;}&#039;, got &#039;EOF&#039; at end of input: …roup : {_id : "'}},[t._v('group : {_id : "')]),t._v('by_user", url : {'),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[a("semantics",[a("mrow",[a("mi",[t._v("a")]),a("mi",[t._v("d")]),a("mi",[t._v("d")]),a("mi",[t._v("T")]),a("mi",[t._v("o")]),a("mi",[t._v("S")]),a("mi",[t._v("e")]),a("mi",[t._v("t")]),a("mo",[t._v(":")]),a("mi",{attrs:{mathvariant:"normal"}},[t._v('"')])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v('addToSet : "')])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),a("span",{staticClass:"mord mathnormal"},[t._v("a")]),a("span",{staticClass:"mord mathnormal"},[t._v("dd")]),a("span",{staticClass:"mord mathnormal",staticStyle:{"margin-right":"0.13889em"}},[t._v("T")]),a("span",{staticClass:"mord mathnormal"},[t._v("o")]),a("span",{staticClass:"mord mathnormal",staticStyle:{"margin-right":"0.05764em"}},[t._v("S")]),a("span",{staticClass:"mord mathnormal"},[t._v("e")]),a("span",{staticClass:"mord mathnormal"},[t._v("t")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}}),a("span",{staticClass:"mrel"},[t._v(":")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}})]),a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),a("span",{staticClass:"mord"},[t._v('"')])])])]),t._v('url"}}}])')])]),t._v(" "),a("tr",[a("td",[t._v("$first")]),t._v(" "),a("td",[t._v("根据资源文档的排序获取第一个文档数据。")]),t._v(" "),a("td",[t._v("db.mycol.aggregate([{"),a("span",{staticClass:"katex-error",attrs:{title:'ParseError: KaTeX parse error: Expected &#039;}&#039;, got &#039;EOF&#039; at end of input: …roup : {_id : "'}},[t._v('group : {_id : "')]),t._v('by_user", first_url : {'),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[a("semantics",[a("mrow",[a("mi",[t._v("f")]),a("mi",[t._v("i")]),a("mi",[t._v("r")]),a("mi",[t._v("s")]),a("mi",[t._v("t")]),a("mo",[t._v(":")]),a("mi",{attrs:{mathvariant:"normal"}},[t._v('"')])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v('first : "')])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.8888799999999999em","vertical-align":"-0.19444em"}}),a("span",{staticClass:"mord mathnormal",staticStyle:{"margin-right":"0.10764em"}},[t._v("f")]),a("span",{staticClass:"mord mathnormal"},[t._v("i")]),a("span",{staticClass:"mord mathnormal"},[t._v("rs")]),a("span",{staticClass:"mord mathnormal"},[t._v("t")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}}),a("span",{staticClass:"mrel"},[t._v(":")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}})]),a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),a("span",{staticClass:"mord"},[t._v('"')])])])]),t._v('url"}}}])')])]),t._v(" "),a("tr",[a("td",[t._v("$last")]),t._v(" "),a("td",[t._v("根据资源文档的排序获取最后一个文档数据")]),t._v(" "),a("td",[t._v("db.mycol.aggregate([{"),a("span",{staticClass:"katex-error",attrs:{title:'ParseError: KaTeX parse error: Expected &#039;}&#039;, got &#039;EOF&#039; at end of input: …roup : {_id : "'}},[t._v('group : {_id : "')]),t._v('by_user", last_url : {'),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[a("semantics",[a("mrow",[a("mi",[t._v("l")]),a("mi",[t._v("a")]),a("mi",[t._v("s")]),a("mi",[t._v("t")]),a("mo",[t._v(":")]),a("mi",{attrs:{mathvariant:"normal"}},[t._v('"')])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v('last : "')])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),a("span",{staticClass:"mord mathnormal",staticStyle:{"margin-right":"0.01968em"}},[t._v("l")]),a("span",{staticClass:"mord mathnormal"},[t._v("a")]),a("span",{staticClass:"mord mathnormal"},[t._v("s")]),a("span",{staticClass:"mord mathnormal"},[t._v("t")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}}),a("span",{staticClass:"mrel"},[t._v(":")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}})]),a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),a("span",{staticClass:"mord"},[t._v('"')])])])]),t._v('url"}}}])')])])])]),t._v(" "),a("h2",{attrs:{id:"mongodb-聚合管道"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-聚合管道"}},[t._v("#")]),t._v(" MongoDB 聚合管道")]),t._v(" "),a("blockquote",[a("p",[t._v("MongoDB 的聚合管道将 MongoDB 文档在一个管道处理完毕后将结果传递给下一个管道处理。管道操作是可以重复的。")])]),t._v(" "),a("p",[a("strong",[t._v("聚合管道示意图：")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/images/763898ac6dbeb7c1e4710676301f8de1.png")}}),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("使用的数据")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("db.books.insert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" title: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Node.js"')]),t._v(", author: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" last: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aaa"')]),t._v(", first: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bbb"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", copies: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" title: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"JavaScript"')]),t._v(", author: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" last: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ccc"')]),t._v(", first: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ddd"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", copies: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("33")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" title: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TypeScript"')]),t._v(", author: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" last: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eee"')]),t._v(", first: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fff"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", copies: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" title: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Vue"')]),t._v(", author: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" last: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ggg"')]),t._v(", first: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hhh"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", copies: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("44")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" title: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CSS"')]),t._v(", author: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" last: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ggg"')]),t._v(", first: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ccc"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", copies: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("44")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])])]),t._v(" "),a("h3",{attrs:{id:"_1、-project"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、-project"}},[t._v("#")]),t._v(" 1、$project")]),t._v(" "),a("blockquote",[a("p",[t._v("$project：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档。")])]),t._v(" "),a("ul",[a("li",[t._v("指定输出字段")])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  只返回 title、copies 字段")]),t._v("\ndb.books.aggregate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id:0,title:1,copies:1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 只返回 title、copies、author 中的 last 字段")]),t._v("\ndb.books.aggregate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id:0,title:1,"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'author.last'")]),t._v(":1,copies:1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 返回 title、 lastName、copies 字段")]),t._v("\ndb.books.aggregate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id:0,title:1,lastName:"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$author")]),t._v('.last"')]),t._v(",copies:1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("img",{attrs:{src:t.$withBase("/images/bestshi.com_2021-04-22_23-24-03.jpg")}}),t._v(" "),a("h3",{attrs:{id:"_2、-match"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、-match"}},[t._v("#")]),t._v(" 2、$match")]),t._v(" "),a("blockquote",[a("p",[t._v("用于过滤文档。用法类似于 find() 方法中的。")])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("db.books.aggregate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id:0,title:1,lastName:"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$author")]),t._v('.last"')]),t._v(",copies:1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$match")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("copies:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$gt")]),t._v(":22"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("img",{attrs:{src:t.$withBase("/images/bestshi.com_2021-04-22_23-59-09.jpg")}}),t._v(" "),a("h3",{attrs:{id:"_3、-group"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、-group"}},[t._v("#")]),t._v(" 3、$group")]),t._v(" "),a("blockquote",[a("p",[t._v("将集合中的文档进行分组，可用于统计结。")])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 统计 author.last = ggg 的 copies 总和")]),t._v("\ndb.books.aggregate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$group")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id:"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$author")]),t._v(".last'")]),t._v(",total:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sum")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$copies")]),t._v("'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("img",{attrs:{src:t.$withBase("/images/bestshi.com_2021-04-23_00-06-17.jpg")}}),t._v(" "),a("h3",{attrs:{id:"_4、-sort"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、-sort"}},[t._v("#")]),t._v(" 4、$sort")]),t._v(" "),a("blockquote",[a("p",[t._v("将集合中的文档进行排序。")])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("db.books.aggregate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$group")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id:"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$author")]),t._v(".last'")]),t._v(",total:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sum")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$copies")]),t._v("'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sort")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("total:-1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("img",{attrs:{src:t.$withBase("/images/bestshi.com_2021-04-23_00-10-40.jpg")}}),t._v(" "),a("h3",{attrs:{id:"_5、-limit-与-skip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、-limit-与-skip"}},[t._v("#")]),t._v(" 5、$limit 与 $skip")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查找第二页数据，每页显示两条")]),t._v("\ndb.books.aggregate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id:0,title:1,lastName:"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$author")]),t._v('.last"')]),t._v(",copies:1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sort")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("copies:1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$skip")]),t._v(":2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$limit")]),t._v(":2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[a("strong",[a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[a("semantics",[a("mrow",[a("mi",[t._v("l")]),a("mi",[t._v("i")]),a("mi",[t._v("m")]),a("mi",[t._v("i")]),a("mi",[t._v("t")]),a("mtext",[t._v("要放在")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("limit要放在")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),a("span",{staticClass:"mord mathnormal",staticStyle:{"margin-right":"0.01968em"}},[t._v("l")]),a("span",{staticClass:"mord mathnormal"},[t._v("imi")]),a("span",{staticClass:"mord mathnormal"},[t._v("t")]),a("span",{staticClass:"mord cjk_fallback"},[t._v("要放在")])])])]),t._v("skip 后面")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/images/bestshi.com_2021-04-23_00-42-57.jpg")}}),t._v(" "),a("h3",{attrs:{id:"_6、-lookup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、-lookup"}},[t._v("#")]),t._v(" 6、$lookup")]),t._v(" "),a("blockquote",[a("p",[t._v("执行左连接到一个集合(unsharded)，必须在同一数据库中。")]),t._v(" "),a("p",[t._v("$lookup 添加了一个新的数组字段，该字段的元素是 joined 集合中的匹配文档。")])]),t._v(" "),a("p",[a("strong",[t._v("语法：")])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$lookup")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       from: "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("collection to join"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(",   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 右集合")]),t._v("\n       localField: "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field from the input documents"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(",  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 左集合 join字段")]),t._v("\n       foreignField: "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("field from the documents of the "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"from"')]),t._v(" collection"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 右集合 join 字段")]),t._v("\n       as: "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("output array field"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新生成字段（类型array）")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("from")]),t._v(" "),a("td",[t._v("右集合（需要关联的集合），指定在同一数据库中执行连接的集合。此集合不能 shared 分片。")])]),t._v(" "),a("tr",[a("td",[t._v("localField")]),t._v(" "),a("td",[t._v("指定左集合（db.collectionname）匹配的字段。如果左集合不包含 localField，$lookup 视为 null 值来匹配。")])]),t._v(" "),a("tr",[a("td",[t._v("foreignField")]),t._v(" "),a("td",[t._v("指定 from 集合（右集合）用来匹配的字段。如果集合不包含该字段，$lookup 视为 null 值来匹配。")])]),t._v(" "),a("tr",[a("td",[t._v("as")]),t._v(" "),a("td",[t._v("指定要添加到输入文档的新数组字段的名称。新的数组字段包含 from 集合中匹配的文档。如果在文档中指定的名称已经存在，现有的领域覆盖。")])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("需要的数据")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("db.orders.insert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" uid: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", sku: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"abc"')]),t._v(", price: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(", quantity: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" uid: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(", sku: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jkl"')]),t._v(", price: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(", quantity: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" uid: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndb.inventory.insert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" uid: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", sku: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"abc"')]),t._v(", description: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"product 1"')]),t._v(", instock: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("120")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" uid: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(", sku: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"def"')]),t._v(", description: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"product 2"')]),t._v(", instock: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" uid: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(", sku: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ijk"')]),t._v(", description: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"product 3"')]),t._v(", instock: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" uid: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(", sku: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jkl"')]),t._v(", description: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"product 4"')]),t._v(", instock: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("70")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" uid: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(", sku: null, description: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Incomplete"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" uid: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("db.orders.aggregate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$lookup")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("from:"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'inventory'")]),t._v(",localField:"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sku'")]),t._v(",foreignField:"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sku'")]),t._v(",as: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'items'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id:0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("strong",[t._v("查询结果：")])]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sku"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"abc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"quantity"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"items"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ObjectId("),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6081a9b715cd6acadc788896"')]),t._v(")"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sku"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"abc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"description"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"product 1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"instock"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("120")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sku"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jkl"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"quantity"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"items"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ObjectId("),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6081a9b715cd6acadc788899"')]),t._v(")"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sku"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jkl"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"description"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"product 4"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"instock"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("70")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"items"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ObjectId("),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6081a9b715cd6acadc78889a"')]),t._v(")"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sku"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"description"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Incomplete"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ObjectId("),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6081a9b715cd6acadc78889b"')]),t._v(")"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);